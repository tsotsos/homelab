apiVersion: v1
kind: Namespace
metadata:
  name: default
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: pihole-credentials
  namespace: default
spec:
  encryptedData:
    EXTERNAL_DNS_PIHOLE_PASSWORD: AgCCpxsyulKvKcUN/5F4sUJZUH0oE2iapJ686SeuqHUZ24s02y4p2vl4g5fVwOYDinYQaHI3ofAl7QEHKHS77XuqZenhDN9i5WbVQZkpwvdS4JVKaSJYI1TxkqJIS81XCvYA2LlywKeWn67fIyjmUZdGe22SryNlTJm+TvUvK6RfhXBDLrqqlY0+5gbKt+l9F17x2WTFQ9nQjozSpf07hH1rkQzmW7Ix5d9JiKpp4yeRIXpHerqBS6DERhDlwtpFYxp/3ce8Fz9YGqKRCUf19siA8Ha1uJu96viBcMOlpZjEEtj4YD26IMl3Xx1GLjhzDY2faK8SRiZPwsSE4tdPGuyPOzEDWSnlpPcwRjbIXKhX5klDsvsI53sw01qKDARj/JnhrBGXYonFSBWdJlTbCc0f8CDGgOF06fTELoXgb0Gd18vthh6GD/YbPJfHYTuSAFuWLVmwyRyIGWRyfJAEFYTc+5nymNl2mpejaghM+yNhniFlEh0AyPi7+eWA1RNI8OW61+DQjL8EG7qvyMIizhIzJ0NpvV95U2+zYV0Yp+Dvak56zVZM4NW7UpLHgHQ0SyOTSc9Cl2l5ftcc0Lqmr7MFpPdjxrdwswMmgTLbkRo0nXaafOm4zKbV4rhvm3VL7ktKqTHuJnPB2m6ux49IOQbAk5eXItOm6CHTybBXwuNuKYKB0pqNZJLhcDTg6NNadWH0D+cH6GTt
    EXTERNAL_DNS_PIHOLE_SERVER: AgBtYVe0kjihPGkQLN6HqZUqWGdhm6/5WosYUNBkHWi+ACuN+RFMBaWgH0lzBnzUEKyeyjPxOsjkqsrgD+reht+CKfmrqS1WdpPmvYQ5zaV+x0hZxEWV+hPN8J2xIidyAs2rkcn2ADY3VZ2QJzz3RcxwMSHjG4h6taQTLU6w43MgkoXIlpKXFitWZxzUCxAN9q5E99WchSp0RU8PcdEe+XctBDTLC3Redk/XcnPDa5Ka6nrw4Sajorh+2UBERp2MWC/HjlFZ8T9RyopF6fprBDDr6ofUZRQP1SziqIsR9DCOfmvkyKYl3bFmG88GE27eOTpe15WIuJAwZkn+MDXb920dOOrPDAr2E8xVyQjAjW2nEE/TTJx6dgXNHu7V8Cm/LpxxRDXBGYvzoQKlA0mTYbAjB31CJBIoPKr63vhmGbyDLqIeCiIWbWxdraP41qXQZVgQ7FmTK42IhmljOSBr5xeuaBO2iBKEGubLPeTBsdsYxdHjQVWSLBesDz7NxV749zSdpSedWxPysw0LrsqFXod57FMx72sDVNWwtnd/Vm5kkHmno17hrru0aYZc+ANP1uPmmheloEoy8f7GiPhDCvJHzHclfSpq0ZkLxBg1I70XCHvqvvFJE5awzZYHAliUBuNhgR/WLicc/rMmjHZVCBIH41vLV5o36Hae6zmV0TBfZWq8zjpiiwkt4GTTXi9AJuNZu3CzqHAY4Io6+qjGjJ8=
  template:
    metadata:
      creationTimestamp: null
      name: pihole-credentials
      namespace: default
    type: Opaque
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-dns
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: external-dns
rules:
- apiGroups: [""]
  resources: ["services","endpoints","pods"]
  verbs: ["get","watch","list"]
- apiGroups: ["extensions","networking.k8s.io"]
  resources: ["ingresses"]
  verbs: ["get","watch","list"]
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["list","watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: external-dns-viewer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: external-dns
subjects:
- kind: ServiceAccount
  name: external-dns
  namespace: default
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: external-dns
spec:
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: external-dns
  template:
    metadata:
      labels:
        app: external-dns
    spec:
      serviceAccountName: external-dns
      containers:
      - name: external-dns
        image: registry.k8s.io/external-dns/external-dns:v0.14.2
        envFrom:
        - secretRef:
            name: pihole-credentials
        args:
        - --source=service
        - --source=ingress
        - --registry=noop
        - --policy=upsert-only
        - --provider=pihole
      securityContext:
        fsGroup: 65534