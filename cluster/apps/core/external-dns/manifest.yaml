apiVersion: v1
kind: Namespace
metadata:
  name: default
---
apiVersion: bitnami.com/v1alpha1
kind: SealedSecret
metadata:
  creationTimestamp: null
  name: pihole-credentials
  namespace: default
spec:
  encryptedData:
    EXTERNAL_DNS_PIHOLE_PASSWORD: AgBD69W+PmLwa/PiuMWxHviLu0fXMnxq4pODlHiEuBlalZ/NgGZMOkdRNd+XxGsju9v789cy7Bl0vX5NVVW78zkU7hqWLlPeoV3fEEUTZAd/r5SvZpHVLu1eIKe/QE7Zd4/A+hadJuF1x0Au6g+fQoWd+nBrXED5MBz8kaHeDPC3uQ3BDVyilRe9tpbrvY4/r+cOckYOMNvWPVQmANC1iGkdHTUp9DQHZ5bu0qdUy2FKA0nItMs14zCz9EfK+Wn4NoDySfRAWWDpLg/q+nCl5XyPOmlQdZCnJ9mlFJOaQRyB7kOGydjnp5AbFpTUePaAb9UiQMMieofnsvrCNbndlDf1IgJxdfj8zFYW6kH+MisZ82TbUmwyjFyfDchF4ANjTavroO+7cBYGXhohvrsEKeyaure+nv87nI2dIfsMHjxIKug4H2llRi5CGMkxOxcOPUKbkDfs3jByoJydlgTpIp1ZBWLGDz+Gc7sybdJYcQpkbtgreG+uUxsJZwdW1MH/CNDebcMsRjpyal/VzX1eXJsjlism/j7RDks3R8U37P0+VjYSdXII6DJeGRUKx0psWnXViDqKgrhgOwfV2u6gCLGMHtfrju17Qy+tz2QcRBOUdOH6VsosXImjB2lOPgbqjqpfWgd3iZCB4FaRmg2Ndv5+d4nsCYn1Azynd47zOK7zLb1sKu2P7K30WxMlqJuOmsW/dZm17n2I
    EXTERNAL_DNS_PIHOLE_SERVER: AgB+VTCghB7tGHj8PUSTiZWvtne5IeXqNLN/5lyUtvyBzwih0LG3L0VnHyi2NFiVd19QpPJBncqh5hbhXIpy2+Suqqk68nwnKihdtwMRZ0xrIn+zPpYktHHRD2xJyad8GbcZTVxTtVBh7mbJsHG+Wt5DdIYnEEQTX3XFcyjYW5czh9WNCM6NRunFwkHuNGuWmvMnYTNv+g0HWEI7+rHLNbbt+ct0L9LT5FfdoqGs8Yv2IIxLH/MQw8iRVsofHKyV0486HuMRpjiCIyPXv39jdbJiHns3Y8Ew/DL7DcHkC6foOr4DA25AFIjLnzWK8DupczcuONMCzy17Qp5f4NDqbpyAnxHFErnXWvFJDLVyxyWBMbDih2vBhVxSyz8S9qHdY27g7Fejj2lsHvbRssqI90Ri4BEiWjLYk5LZcjveX5tk5pk6I5evRXNf3F8FLIGFyJT8ahGIqcIzp9t66aJ6GRTAZJo5mrhmx5S/i+uiFcA8BiKpr4FFnVD5iJxk+pC3nq51X3GQDcMDpRUK4WpBPkeq3XJyIuufBpURN4MnkbaB6KssfbXjB7hFWOKhHI0G5uf9CKUMEjRGzqNTo9igV6GgINePO7579VXb/kEyVfXTmOP+GhoUVi8Bc4nYghIPU0MRM8ekfrDDs/hINBfJ8LO3J9w5pJyGYk1LFCG+5ERAuJzhpMRqSV/fQzGiTZlGmaGTH8e/Cutp6lxlMurok8E=
  template:
    metadata:
      creationTimestamp: null
      name: pihole-credentials
      namespace: default
    type: Opaque
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-dns
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: external-dns
rules:
- apiGroups: [""]
  resources: ["services","endpoints","pods"]
  verbs: ["get","watch","list"]
- apiGroups: ["extensions","networking.k8s.io"]
  resources: ["ingresses"]
  verbs: ["get","watch","list"]
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["list","watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: external-dns-viewer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: external-dns
subjects:
- kind: ServiceAccount
  name: external-dns
  namespace: default
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: external-dns
spec:
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: external-dns
  template:
    metadata:
      labels:
        app: external-dns
    spec:
      serviceAccountName: external-dns
      containers:
      - name: external-dns
        image: registry.k8s.io/external-dns/external-dns:v0.14.2
        envFrom:
        - secretRef:
            name: pihole-credentials
        args:
        - --source=service
        - --source=ingress
        - --registry=noop
        - --policy=upsert-only
        - --provider=pihole
      securityContext:
        fsGroup: 65534