persistence:
  enabled: true
  accessMode: ReadWriteOnce
  size: 10Gi
  storageClass: longhorn

hostNetwork: true
dnsConfig:
  nameservers:
    - 10.43.0.10
    - 10.0.1.7
  options:
    - name: ndots
      value: "5"
    - name: edns0
ingress:
  enabled: true
  className: nginx
  annotations:
    #nginx.ingress.kubernetes.io/service-upstream: "true"
    cert-manager.io/common-name: home.kng.house
    cert-manager.io/cluster-issuer: letsencrypt-prod
    external-dns.alpha.kubernetes.io/hostname: home.kng.house
  hosts:
    - host: home.kng.house
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: homeassistant-cert
      hosts:
        - home.kng.house
envFrom:
   - secretRef:
       name: homeassistant-secret
configuration:
  enabled: true
  forceInit: true
  trusted_proxies:
    - 10.43.0.0/16
    - 10.42.0.0/16
    - 10.0.2.0/24
    - ::1
  templateConfig: |-
      default_config:
      {{- if .Values.ingress.enabled }}
      http:
        use_x_forwarded_for: true
        trusted_proxies:
          {{- range .Values.configuration.trusted_proxies }}
          - {{ . }}
          {{- end }}
      {{- end}}
      {{ .Files.Get "./hass_config/init.yaml" . }}
      recorder:
        purge_keep_days: 90
        commit_interval: 3
        db_url: !env_var DB_CONNECTION
addons:
  codeserver:
    enabled: true
    ingress:
      enabled: true
      className: nginx
      annotations:
        #nginx.ingress.kubernetes.io/service-upstream: "true"
        cert-manager.io/common-name: home-code.kng.house
        cert-manager.io/cluster-issuer: letsencrypt-prod
        external-dns.alpha.kubernetes.io/hostname: home-code.kng.house
      hosts:
        - host: home-code.kng.house
          paths:
            - path: /
              pathType: Prefix
      tls:
        - secretName: home-code-cert
          hosts:
            - home-code.kng.house
#wget -O - https://get.hacs.xyz | bash -