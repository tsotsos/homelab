# InfluxDB v2 Configuration with Longhorn Storage

# Authentication
adminUser:
  organization: "influxdata"
  bucket: "default"
  user: "admin"
  retention_policy: "0s"
  # Leave password and token empty when using existingSecret
  password: ""
  token: ""
  # Use existing secret for admin credentials
  existingSecret: influxdb-auth

# Persistence with Longhorn
persistence:
  enabled: true
  storageClass: longhorn
  size: 200Gi
  accessMode: ReadWriteOnce

# Resources
resources:
  requests:
    memory: 512Mi
    cpu: 250m
  limits:
    memory: 2Gi
    cpu: 1000m

# Pod affinity - removed s01 zone requirement due to storage issues
# affinity:
#   nodeAffinity:
#     requiredDuringSchedulingIgnoredDuringExecution:
#       nodeSelectorTerms:
#         - matchExpressions:
#             - key: topology.kubernetes.io/zone
#               operator: In
#               values:
#                 - s01
            # - key: node.kng/workload-infra
            #   operator: In
            #   values:
            #     - "true"

# Service configuration
service:
  type: ClusterIP
  port: 8086
  targetPort: 8086

# Ingress configuration
ingress:
  enabled: true
  className: cilium
  hostname: influxdb.kng.house
  tls: true
  secretName: influxdb-tls
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-dns
    external-dns.alpha.kubernetes.io/hostname: influxdb.kng.house

# InfluxDB configuration
influxdb:
  # HTTP configuration
  http:
    enabled: true
    bindAddress: ":8086"
  
  # Logging
  logging:
    level: info
  
  # Continuous queries (v1 compatibility)
  continuousQueries:
    enabled: false

# Metrics and monitoring
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    namespace: influxdb
    interval: 30s
    scrapeTimeout: 10s
