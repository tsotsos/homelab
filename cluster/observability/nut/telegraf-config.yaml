apiVersion: v1
kind: ConfigMap
metadata:
  name: telegraf-config
  namespace: monitoring
  labels:
    app: nut-server

data:
  telegraf.conf: |
    [[inputs.prometheus]]
      urls = ["http://127.0.0.1:9199/metrics"]
      metric_version = 2
      interval = "30s"
      # Only collect UPS/NUT metrics, exclude Go runtime and promhttp metrics
      namepass = ["network_ups_*"]

    [[outputs.influxdb_v2]]
      urls = ["http://influxdb-influxdb2.influxdb.svc.cluster.local:8086"]
      token = "$INFLUXDB_TOKEN"
      organization = "influxdata"
      bucket = "default"

    [global_tags]
      environment = "homelab"
