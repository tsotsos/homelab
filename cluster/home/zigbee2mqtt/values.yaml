# Zigbee2MQTT Configuration using official Koenkk chart
image:
  repository: koenkk/zigbee2mqtt
  tag: null  # Use chart appVersion (2.7.1)
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8080

# Disable direct ingress - using Authentik proxy
ingress:
  enabled: false

statefulset:

  # Disable liveness probe (no enabled flag in this chart, use empty object)
  livenessProbe: {}
  
  # Pod security context - disable seccomp profile that requires SYS_ADMIN
  podSecurityContext:
    seccompProfile:
      type: RuntimeDefault
  
  # Container security context - disable privileged mode (not needed for TCP adapter)
  securityContext:
    privileged: false
    capabilities:
      add: []
      drop:
        - ALL
  
  # Persistent storage - chart manages via volumeClaimTemplates
  storage:
    enabled: true
    size: 5Gi
    storageClassName: longhorn
  
  # Resources
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Zigbee2MQTT configuration
zigbee2mqtt:
  homeassistant:
    enabled: true
  
  permit_join: false
  
  mqtt:
    server: mqtt://emqx.emqx.svc.cluster.local:1883
    base_topic: zigbee2mqtt
  
  serial:
    port: tcp://10.0.5.11:6638
    adapter: ember
    baudrate: 115200
    disable_led: false
  
  frontend:
    enabled: true
    port: 8080
  
  availability:
    enabled: true
    # Active devices = powered routers (bulbs/plugs/relays)
    active:
      timeout: 20
      # Optional fine-tuning to prevent aggressive ping storms on flaky links:
      pause_on_backoff_gt: 3
    # Passive devices = battery devices (sensors/buttons)
    passive:
      timeout: 740

  advanced:
    transmit_power: 20
    channel: 25
    # TEMPORARY: Keys for network reset - WILL BE REMOVED after reset completes
    pan_id: 0xf35a
    network_key: [0x09, 0xc0, 0x1f, 0x26, 0xd7, 0x59, 0x54, 0x43, 0xb6, 0xe2, 0x53, 0x78, 0xd0, 0xe3, 0x57, 0x34]
    ext_pan_id: [0xa0, 0x20, 0x41, 0xdc, 0xb3, 0xe6, 0x72, 0xe5]
    log_level: info
    cache_state: true
    adapter_concurrent: null
    rtscts: false
    last_seen: ISO_8601
    
    # NETWORK RESET - Enabled to force coordinator reset with new keys
    force_network_reset: true
