# Zigbee2MQTT Configuration using official Koenkk chart
image:
  repository: koenkk/zigbee2mqtt
  tag: null  # Use chart appVersion (2.7.1)
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8080

# Disable direct ingress - using Authentik proxy
ingress:
  enabled: false

statefulset:
  # Ensure pod is scheduled in s01 zone
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: topology.kubernetes.io/zone
                operator: In
                values:
                  - s01
  
  # Disable liveness probe (no enabled flag in this chart, use empty object)
  livenessProbe: {}
  
  # Pod security context - disable seccomp profile that requires SYS_ADMIN
  podSecurityContext:
    seccompProfile:
      type: RuntimeDefault
  
  # Container security context - disable privileged mode (not needed for TCP adapter)
  securityContext:
    privileged: false
    capabilities:
      add: []
      drop:
        - ALL
  
  # Persistent storage - use existing PVC to avoid StatefulSet volumeClaimTemplates
  storage:
    enabled: false  # Disable volumeClaimTemplates
    existingVolume: zigbee2mqtt-data
  
  # Resources
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Zigbee2MQTT configuration
zigbee2mqtt:
  homeassistant:
    enabled: true
  
  permit_join: false
  
  mqtt:
    server: mqtt://emqx.emqx.svc.cluster.local:1883
    base_topic: zigbee2mqtt
  
  serial:
    port: tcp://10.0.5.10:6638
    adapter: zigate  # XZG gateway uses ZiGate protocol
    baudrate: 115200
    disable_led: false
  
  frontend:
    enabled: true
    port: 8080
  
  advanced:
    transmit_power: 20
    channel: 11
    log_level: info
    cache_state: true
