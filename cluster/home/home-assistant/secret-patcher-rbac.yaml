---
# Role to allow patching home-assistant-secrets (for InfluxDB token storage)
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: homeassistant-secret-patcher
  namespace: home-assistant
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    resourceNames: ["home-assistant-secrets"]
    verbs: ["get", "patch"]
---
# RoleBinding to allow homeassistant-influxdb-init to patch secrets
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: homeassistant-influxdb-init-secret-patcher
  namespace: home-assistant
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: homeassistant-secret-patcher
subjects:
  - kind: ServiceAccount
    name: homeassistant-influxdb-init
    namespace: home-assistant
---
# Role to allow reading InfluxDB secrets from observability namespace
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: homeassistant-influxdb-secret-reader
  namespace: observability
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    resourceNames: ["influxdb-auth"]
    verbs: ["get"]
---
# RoleBinding to allow homeassistant-influxdb-init to read InfluxDB secrets
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: homeassistant-influxdb-secret-reader
  namespace: observability
  annotations:
    argocd.argoproj.io/sync-wave: "-10"
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: homeassistant-influxdb-secret-reader
subjects:
  - kind: ServiceAccount
    name: homeassistant-influxdb-init
    namespace: home-assistant
