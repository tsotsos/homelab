# Matter-over-Thread Configuration using Zigbee2MQTT with zstack adapter
image:
  repository: koenkk/zigbee2mqtt
  tag: null  # Use chart appVersion (2.7.1)
  pullPolicy: IfNotPresent

service:
  type: LoadBalancer
  port: 8080
  annotations:
    kube-vip.io/loadbalancerIPs: "10.0.2.85"

# Disable direct ingress
ingress:
  enabled: false

statefulset:
  # Ensure pod is scheduled in s01 zone (same as SLZB-MR3 device)
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: topology.kubernetes.io/zone
                operator: In
                values:
                  - s01
  
  # Disable liveness probe
  livenessProbe: {}
  
  # Pod security context
  podSecurityContext:
    seccompProfile:
      type: RuntimeDefault
  
  # Container security context
  securityContext:
    privileged: false
    capabilities:
      add: []
      drop:
        - ALL
  
  # Persistent storage
  storage:
    enabled: true
    size: 5Gi
    storageClassName: longhorn
  
  # Resources
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Zigbee2MQTT configuration for Matter-over-Thread
zigbee2mqtt:
  homeassistant:
    enabled: true
  
  permit_join: false
  
  mqtt:
    server: mqtt://emqx.emqx.svc.cluster.local:1883
    base_topic: matter-thread
  
  serial:
    port: tcp://10.0.5.11:7638
    adapter: zstack
    baudrate: 460800
    disable_led: false
  
  frontend:
    enabled: true
    port: 8080
  
  advanced:
    transmit_power: 20
    channel: 15
    pan_id: 0x1a63
    network_key: [0x02, 0x04, 0x06, 0x08, 0x0a, 0x0c, 0x0e, 0x10, 0x01, 0x03, 0x05, 0x07, 0x09, 0x0b, 0x0d, 0x0f]
    ext_pan_id: [0xee, 0xee, 0xee, 0xee, 0xee, 0xee, 0xee, 0xee]
    log_level: info
    cache_state: true
    adapter_concurrent: null
    rtscts: false
